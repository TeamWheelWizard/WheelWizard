<base:PopupContent xmlns="https://github.com/avaloniaui"
                   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                   xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                   xmlns:behavior="clr-namespace:WheelWizard.Views.BehaviorComponent"
                   xmlns:components="clr-namespace:WheelWizard.Views.Components"
                   xmlns:lang="clr-namespace:WheelWizard.Resources.Languages"
                   xmlns:miiVars="using:WheelWizard.MiiImages.Domain"
                   xmlns:base="clr-namespace:WheelWizard.Views.Popups.Base"
                   xmlns:popups="clr-namespace:WheelWizard.Views.Popups"
                   xmlns:conv="clr-namespace:WheelWizard.Views.Converters"
                   mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="600" ClipToBounds="False"
                   x:Class="WheelWizard.Views.Popups.PlayerProfileWindow"
                   x:DataType="popups:PlayerProfileWindow">
    <Grid Width="480" MinHeight="400" MaxHeight="700">
        <!-- Loading State -->
        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="20"
                    IsVisible="{Binding IsLoading}">
            <components:LoadingIcon Width="80" Height="80" Foreground="{StaticResource Neutral700}" />
            <TextBlock Text="Loading profile..." Classes="BodyText" HorizontalAlignment="Center" />
        </StackPanel>

        <!-- Error State -->
        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="20"
                    IsVisible="{Binding HasError}">
            <PathIcon Data="{StaticResource WarningTriangle}" Width="60" Height="60"
                      Foreground="{StaticResource Danger600}" />
            <TextBlock Text="{Binding ErrorMessage}" Classes="BodyText" HorizontalAlignment="Center"
                       TextWrapping="Wrap" Foreground="{StaticResource Danger600}" />
        </StackPanel>

        <!-- Content State -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled"
                      IsVisible="{Binding Profile, Converter={x:Static ObjectConverters.IsNotNull}}">
            <StackPanel Spacing="20" Margin="0,10">
                <!-- Header Section: Mii and Name -->
                <Grid ColumnDefinitions="Auto,*">
                    <!-- Mii Display -->
                    <Border Grid.Column="0" CornerRadius="999999" ClipToBounds="True"
                            Background="{StaticResource Neutral950}" Width="100" Height="100" Margin="0,0,20,0">
                        <behavior:MiiImageLoader HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                                  LoadingColor="{StaticResource Neutral600}"
                                                  Mii="{Binding DisplayMii}"
                                                  FallBackColor="{StaticResource Neutral600}"
                                                  ImageVariant="{x:Static miiVars:MiiImageVariants.OnlinePlayerSmall}" />
                    </Border>

                    <!-- Name and Friend Code -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="8">
                        <TextBlock Text="{Binding Profile.Name}" Classes="TitleText" FontSize="24"
                                   Foreground="{StaticResource FormFieldLabelColor}" />
                        <TextBlock Text="{Binding Profile.FriendCode}" Classes="BodyText" FontSize="14"
                                   Foreground="{StaticResource Neutral400}" />
                        <components:StateBox Text="{Binding Profile.Rank, StringFormat='Rank #{0}'}" 
                                           Variant="Success" IconSize="0" HorizontalAlignment="Left"
                                           IsVisible="{Binding Profile.Rank, Converter={x:Static conv:NumberConverters.GreaterThan0}}" />
                        <components:StateBox Text="Suspicious" Variant="Danger" IconSize="0"
                                           HorizontalAlignment="Left"
                                           IsVisible="{Binding Profile.IsSuspicious}" />
                    </StackPanel>
                </Grid>

                <Border Background="{StaticResource BackgroundLineColor}" Height="1" />

                <!-- Stats Section -->
                <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto">
                    <!-- VR -->
                    <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,20,15">
                        <components:FormFieldLabel Text="{x:Static lang:Common.Attribute_VrAbbreviation}"
                                                   TipText="{x:Static lang:Common.Attribute_VrFull}" />
                        <components:StateBox Text="{Binding Profile.Vr}" IconSize="0" HorizontalAlignment="Left" />
                    </StackPanel>

                    <!-- Last Seen -->
                    <StackPanel Grid.Column="1" Grid.Row="0" Margin="0,0,0,15">
                        <components:FormFieldLabel Text="Last Seen" />
                        <TextBlock Text="{Binding LastSeenText}" Classes="BodyText" FontSize="14" />
                    </StackPanel>

                    <!-- VR Stats: Last 24 Hours -->
                    <StackPanel Grid.Column="0" Grid.Row="1" Margin="0,0,20,15">
                        <components:FormFieldLabel Text="VR (24h)" />
                        <components:StateBox Text="{Binding Profile.VrStats.Last24Hours, StringFormat='+{0}'}"
                                           Variant="Success" IconSize="0" HorizontalAlignment="Left"
                                           IsVisible="{Binding Profile.VrStats, Converter={x:Static ObjectConverters.IsNotNull}}" />
                        <TextBlock Text="--" Classes="BodyText" FontSize="14"
                                   IsVisible="{Binding Profile.VrStats, Converter={x:Static ObjectConverters.IsNull}}" />
                    </StackPanel>

                    <!-- VR Stats: Last Week -->
                    <StackPanel Grid.Column="1" Grid.Row="1" Margin="0,0,0,15">
                        <components:FormFieldLabel Text="VR (Week)" />
                        <components:StateBox Text="{Binding Profile.VrStats.LastWeek, StringFormat='+{0}'}"
                                           Variant="Success" IconSize="0" HorizontalAlignment="Left"
                                           IsVisible="{Binding Profile.VrStats, Converter={x:Static ObjectConverters.IsNotNull}}" />
                        <TextBlock Text="--" Classes="BodyText" FontSize="14"
                                   IsVisible="{Binding Profile.VrStats, Converter={x:Static ObjectConverters.IsNull}}" />
                    </StackPanel>

                    <!-- VR Stats: Last Month -->
                    <StackPanel Grid.Column="0" Grid.Row="2" Grid.ColumnSpan="2">
                        <components:FormFieldLabel Text="VR (Month)" />
                        <components:StateBox Text="{Binding Profile.VrStats.LastMonth, StringFormat='+{0}'}"
                                           Variant="Success" IconSize="0" HorizontalAlignment="Left"
                                           IsVisible="{Binding Profile.VrStats, Converter={x:Static ObjectConverters.IsNotNull}}" />
                        <TextBlock Text="--" Classes="BodyText" FontSize="14"
                                   IsVisible="{Binding Profile.VrStats, Converter={x:Static ObjectConverters.IsNull}}" />
                    </StackPanel>
                </Grid>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</base:PopupContent>

